#!/bin/bash 

source config.sh
source fonction.sh

echo "
*************************************************************************************
*************************************************************************************
********************************Test de la config reseau sur www.google.fr***********
*************************************************************************************
*************************************************************************************
"
ping -c 3 www.google.fr > /dev/null

if [[ $? -eq 0 ]]; then
    echo -e "${valid}
*************************************************************************************
********************************Config reseau OK !***********************************
*************************************************************************************${blanc}
"
else
    echo -e "${erreur}
*************************************************************************************
********************************Erreur dans la config reseau*************************
*************************************************************************************${blanc}
"
    exit 1
fi


echo "
*************************************************************************************
*************************************************************************************
********************************Installation de Apache2 Server***********************
*************************************************************************************
*************************************************************************************
"

apt update > /dev/null

apt install -y apache2 php php-cli php-common php-mysql php-xml php-ldap php-curl php-intl php-bz2 php-zip php-gd php-mbstring libapache2-mod-php mariadb-server


systemctl restart apache2

if [[ $? -eq 0 ]]; then
    echo -e "${valid}
*************************************************************************************
*************************************************************************************
********************************Installation reussite********************************
*************************************************************************************
*************************************************************************************



*************************************************************************************
********** Pensez à exécuter 'mysql_secure_installation' pour sécuriser mariadb *****
*************************************************************************************${blanc}

******************************************************
Connectez-vous à cette IP sur le poste client : ${valid}$(ip -4 addr show | grep -oP '(?<=inet\s)\d+(\.\d+){3}' | grep -v 127.0.0.1)${blanc}******
******************************************************

***********************************************
Le chemin de vos pages web est ${valid}/var/www/html${blanc} ***
***********************************************
"
else
    echo -e "${erreur}
*************************************************************************************
*************************************************************************************
********************************Erreur lors de l'installation************************
*************************************************************************************
*************************************************************************************${blanc}
"
fi

echo "[Appuyer sur entrer pour continuer]"
read
